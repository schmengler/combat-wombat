var J=Object.defineProperty,q=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var L=(o,t,n)=>t in o?J(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n,j=(o,t)=>{for(var n in t||(t={}))W.call(t,n)&&L(o,n,t[n]);if(T)for(var n of T(t))D.call(t,n)&&L(o,n,t[n]);return o},V=(o,t)=>q(o,Q(t));var F=(o,t)=>{var n={};for(var r in o)W.call(o,r)&&t.indexOf(r)<0&&(n[r]=o[r]);if(o!=null&&T)for(var r of T(o))t.indexOf(r)<0&&D.call(o,r)&&(n[r]=o[r]);return n};var f=(o,t,n)=>(L(o,typeof t!="symbol"?t+"":t,n),n);import{j as G,t as X,r as N,R as Y,a as Z}from"./vendor.56f34d6f.js";const _=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}};_();var R;(function(o){o.None="keine Wunde",o.Muscle="Muskel",o.Sinew="Sehne",o.Bones="Knochen",o.Organ="Organ"})(R||(R={}));class k{constructor(t){f(this,"characterId");f(this,"value",0);f(this,"rounds",0);f(this,"woundType",R.None);f(this,"inflictedByCharacterId",null);f(this,"fresh",!0);this.characterId=t}isEmpty(){return this.rounds==0}isInflictedBy(t){return t.id==this.inflictedByCharacterId}isInflictedByAny(t){const n=t.map(r=>r.id);return this.inflictedByCharacterId!==null&&n.includes(this.inflictedByCharacterId)}withRounds(t){return Object.assign(this,{rounds:this.rounds+t})}static clone(t){return Object.assign(new k(t.characterId),t)}withFresh(t){return Object.assign(this,{fresh:t})}isNotFresh(){return!this.fresh}}const v=class{constructor(t,n){f(this,"id");f(this,"name");f(this,"ini");f(this,"hits",0);f(this,"bleeding",0);f(this,"boniOrMali",[]);f(this,"parryWithMali",[]);f(this,"noParry");f(this,"dizzy");f(this,"diesInRounds",0);f(this,"onGround",!1);f(this,"disarmed",!1);f(this,"consciousness",!1);f(this,"dead",!1);f(this,"notes","");this.id=v.nextId++,this.name=t,this.ini=n,this.dizzy=new k(this.id),this.noParry=new k(this.id)}static turnModifiers(t,n){return t.map(r=>k.clone(r)).map(r=>n(r)?r.withRounds(-1):r).map(r=>r.withFresh(!1)).filter(r=>r.rounds>0)}static turnModifier(t,n){let r=k.clone(t);return n(r)&&(r=r.withRounds(-1)),r.rounds<=0&&(r=new k(r.characterId)),r.withFresh(!1)}beforeTurn(t){const n=v.clone(this);return t.filter(r=>r.id!==n.id).forEach(r=>{const s=a=>a.isInflictedBy(n);r.boniOrMali=v.turnModifiers(r.boniOrMali,s),r.parryWithMali=v.turnModifiers(r.parryWithMali,s),r.noParry=v.turnModifier(r.noParry,s),r.dizzy=v.turnModifier(r.dizzy,s)}),n.hits+=n.bleeding,n.diesInRounds=Math.max(0,n.diesInRounds-1),n.diesInRounds==0&&this.diesInRounds>0&&(n.dead=!0),n}afterTurn(t){const n=v.clone(this),r=s=>s.isInflictedBy(n)&&s.isNotFresh()||!s.isInflictedByAny(t);return n.boniOrMali=v.turnModifiers(n.boniOrMali,r),n.parryWithMali=v.turnModifiers(n.parryWithMali,r),n.dizzy=v.turnModifier(n.dizzy,r),n.noParry=v.turnModifier(n.noParry,r),n}canAct(){return!this.dead&&!this.consciousness}static clone(t){return Object.assign(new v("",0),t)}};let B=v;f(B,"nextId",1);const e=G.exports.jsx,p=G.exports.jsxs;X.exports.Simulate.input;function ee({setCharacters:o}){return p("form",{onSubmit:n=>{n.preventDefault();const r=n.target.elements.namedItem("addText");if(r.value.trim()=="")return;const s=r.value.match(/^(?:(\d+) )?(.*?)(?: (\d+))?$/),a=Number.parseInt(s[1])||1,i=s[2],h=Number.parseInt(s[3])||0,c=Array.from({length:a},(l,b)=>new B(i+(a>1?" "+(b+1):""),h));o(l=>[...l,...c]),r.value=""},children:[e("svg",{className:"w-6 h-6 inline text-green-600",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e("path",{d:"M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"})}),e("input",{name:"addText",type:"text",className:"mx-2",placeholder:"[Anzahl] Name [Ini]"}),e("button",{type:"submit",className:"inline-block px-7 py-3 bg-amber-600 text-white font-bold text-xl leading-snug uppercase rounded shadow-md hover:bg-amber-700 hover:shadow-lg focus:bg-amber-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-amber-800 active:shadow-lg transition duration-150 ease-in-out",children:"Hinzuf\xFCgen"})]})}function te({setCharacters:o,characterId:t}){return e("button",{onClick:()=>{o(r=>{const s=r.findIndex(a=>a.id==t);return r.filter((a,i)=>i!=s)})},children:e("svg",{className:"w-6 h-6 inline text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7a4 4 0 11-8 0 4 4 0 018 0zM9 14a6 6 0 00-6 6v1h12v-1a6 6 0 00-6-6zM21 12h-6"})})})}function ne({entity:o,property:t,setEntity:n}){const r=N.exports.useRef(null),s=i=>{n(h=>Object.assign(Object.create(Object.getPrototypeOf(h)),V(j({},h),{[t]:i.target.elements[t].value}))),i.preventDefault()},a=()=>r.current.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}));return e("form",{onSubmit:s,ref:r,children:e("input",{type:"text",name:t,defaultValue:o[t],className:"w-12",onBlur:a})})}function K({entity:o,property:t,setEntity:n,decorateUpdate:r,propertyToNumber:s,minValue:a=Number.MIN_SAFE_INTEGER,invertColors:i=!1,useBigSteps:h=!1}){const c=N.exports.useRef(null),l=N.exports.useRef(null),b=N.exports.useRef(null),[x,u]=N.exports.useState(!1);function M(O){n(z=>{const P=Object.assign(Object.create(Object.getPrototypeOf(z)),z);return P[t]=r(O)(P[t]),P})}const w=(O=1)=>()=>{M(z=>Math.max(a,z+O)),d()},y=(O=1)=>w(-O),C=O=>{M(()=>Math.max(a,Number.parseInt(O.target.value)))},d=()=>u(!0),m=function(){setTimeout(()=>{document.activeElement?u(b.current==document.activeElement.parentElement||l.current==document.activeElement.parentElement):u(!1)},10)},g=O=>O.key=="Enter"&&O.target.blur(),I="inline-block m-1 rounded-full bg-red-600 text-white leading-normal uppercase shadow-md hover:bg-red-700 hover:shadow-lg focus:bg-red-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-red-800 active:shadow-lg transition duration-150 ease-in-out w-9 h-9",E="inline-block m-1 rounded-full bg-green-600 text-white leading-normal uppercase shadow-md hover:bg-green-700 hover:shadow-lg focus:bg-green-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-green-800 active:shadow-lg transition duration-150 ease-in-out w-9 h-9",H=s(o[t]);return e("div",{className:"custom-number-input h-full w-full",children:p("div",{ref:b,className:"flex flex-col h-full w-full rounded-lg relative bg-transparent mt-1 items-center",children:[e("button",{className:"bg-amber-100 text-amber-600 hover:text-amber-700 hover:bg-amber-200 h-full w-10 rounded-r cursor-pointer",onClick:w(),onBlur:m,children:e("span",{className:"m-auto text-2xl font-thin",children:"+"})}),e("input",{type:"number",ref:c,className:"outline-none focus:outline-none text-center w-10 bg-amber-100 font-semibold text-md hover:text-black focus:text-black  md:text-basecursor-default flex items-center text-amber-700  outline-none border-0 focus:ring-0 px-0 text-sm",value:H,onClick:d,onChange:C,onKeyPress:g,onBlur:m}),e("button",{className:" bg-amber-100 text-amber-600 hover:text-amber-700 hover:bg-amber-200 h-full w-10 rounded-l cursor-pointer outline-none",onClick:y(),onBlur:m,children:e("span",{className:"m-auto text-2xl font-thin",children:"\u2212"})}),p("div",{ref:l,hidden:!x||!h,className:"absolute bg-amber-100 left-full p-2 z-10 drop-shadow",children:[e("button",{className:i?E:I,onClick:w(10),onBlur:m,children:"+10"}),e("button",{className:i?E:I,onClick:w(100),onBlur:m,children:"+100"}),e("br",{}),e("button",{className:i?I:E,onClick:y(10),onBlur:m,children:"-10"}),e("button",{className:i?I:E,onClick:y(100),onBlur:m,children:"-100"})]})]})})}const re=o=>n=>{var t=F(n,[]);return e(o,j({decorateUpdate:a=>a,propertyToNumber:a=>a},t))};var S=re(K);function U({entity:o,property:t,setEntity:n,getCurrentCharacter:r,invertColors:s=!0,useWoundType:a=!1}){const i=o.id,[h,c]=N.exports.useState(!1),[l,b]=N.exports.useState(new k(i)),x=d=>{b(m=>{const g=Object.assign(new k(i),m);return g.woundType=R[d.target.value],g})},u=d=>{n(m=>{if(l.isEmpty())return m;const g=Object.assign(new B("",0),m),I=Object.assign(new k(i),l);return I.inflictedByCharacterId=r().id,b(new k(i)),g[t]=[...g[t],I],c(!1),g})},M=d=>()=>n(m=>{const g=Object.assign(new B("",0),m);return g[t]=g[t].filter(I=>I!==d),g}),w=N.exports.useRef(null),y=()=>{c(!1)};N.exports.useEffect(()=>{const d=m=>{w.current&&!w.current.contains(m.target)&&y&&y()};return document.addEventListener("click",d,!0),()=>{document.removeEventListener("click",d,!0)}},[y]);const C=o[t];return p("div",{className:"h-full w-full relative cursor-help",children:[e("div",{className:"h-full w-full text-2xl",onClick:()=>c(d=>!d),children:C.reduce((d,m)=>d+m.value,0)}),p("div",{ref:w,hidden:!h,className:"absolute bg-amber-100 top-10 p-2 z-10 drop-shadow text-left",children:[e("ol",{children:C.map((d,m)=>p("li",{className:"text-xl",children:[e("button",{className:"inline-block text-orange-400",onClick:M(d),children:e("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),"\xA0",e("strong",{className:d.value>0?"text-green-600":"text-red-600",children:d.value}),"\xA0(",d.rounds,") \xA0",a&&e("strong",{children:d.woundType})]},m))}),e("button",{className:"block px-7 py-3 bg-amber-600 text-white font-bold text-xl leading-snug uppercase rounded shadow-md hover:bg-amber-700 hover:shadow-lg focus:bg-amber-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-amber-800 active:shadow-lg transition duration-150 ease-in-out",onClick:u,children:e("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),p("table",{children:[e("thead",{children:p("tr",{children:[e("th",{className:"font-bold text-center",children:"Runden"}),e("th",{className:"font-bold text-center",children:"Bonus/Malus"})]})}),p("tbody",{children:[p("tr",{children:[e("td",{children:e(S,{entity:l,setEntity:b,property:"rounds",minValue:0})}),e("td",{children:e(S,{entity:l,setEntity:b,property:"value",useBigSteps:!0,invertColors:s})})]}),a&&e("tr",{children:e("td",{colSpan:2,children:e("fieldset",{children:Object.entries(R).map(d=>p("label",{className:"block py-2 cursor-pointer",children:[e("input",{name:"woundType",value:d[0],type:"radio",onChange:x,className:"text-amber-600 focus:ring-amber-400"})," ",d[1]]},d[0]))})})})]})]})]})]})}function A({entity:o,setEntity:t,property:n}){const r=s=>{t(a=>{const i=Object.assign(Object.create(Object.getPrototypeOf(a)),a);return i[n]=s.target.checked,i})};return e("div",{className:"w-full relative",children:p("label",{className:"select-none container block relative cursor-pointer text-xl pl-8 left-1/2 -ml-4",children:[e("input",{className:"absolute opacity-0 left-0 top-0 cursor-pointer",type:"checkbox",checked:o[n],onChange:r}),e("span",{className:"h-6 w-6 checkmark absolute top-0 left-0 bg-amber-100"})]})})}function oe({entity:o,property:t,setEntity:n}){const r=N.exports.useRef(null),s=i=>{n(h=>Object.assign(Object.create(Object.getPrototypeOf(h)),V(j({},h),{[t]:i.target.elements[t].value}))),i.preventDefault()},a=()=>r.current.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}));return e("form",{onSubmit:s,ref:r,children:e("textarea",{name:t,defaultValue:o[t],className:"w-full",onBlur:a})})}const se=o=>r=>{var s=r,{getCurrentCharacter:t}=s,n=F(s,["getCurrentCharacter"]);return e(o,j({decorateUpdate:h=>c=>{const l=k.clone(c);return l.rounds=h(l.rounds),l.inflictedByCharacterId=t().id,l},propertyToNumber:h=>h&&h.rounds||0},n))};var $=se(K);function ie({tdClass:o,isEven:t,isCurrent:n,currentId:r,characters:s,setCharacters:a,characterId:i}){const h=s.findIndex(C=>C.id==i),c=s[h],l=C=>{a(d=>{const m=d.findIndex(I=>I.id==i),g=[...d];return g[m]=C(g[m]),g})},b=()=>r==null&&s.length>0?c:s.find(C=>C.id==r)||c,x="hover:bg-orange-50 dark:hover:bg-amber-700",u="bg-amber-50 hover:bg-orange-50 dark:hover:bg-amber-700",M=" bg-green-50",w=" bg-red-300 opacity-50",y=(t?u:x)+(n?M:"")+(c.canAct()?"":w);return p("tr",{className:y,"data-character-id":i,children:[p("td",{className:o+"overflow-hidden",children:[e(te,{setCharacters:a,characterId:i}),e("div",{className:"inline-block font-bold text-lg -rotate-90",children:c.name})]}),e("td",{className:o,children:e(ne,{entity:c,setEntity:l,property:"ini"})}),e("td",{className:o,children:e(S,{entity:c,setEntity:l,property:"hits",minValue:0,useBigSteps:!0})}),e("td",{className:o,children:e(S,{entity:c,setEntity:l,property:"bleeding",minValue:0})}),e("td",{className:o,children:e(U,{entity:c,getCurrentCharacter:b,setEntity:l,property:"boniOrMali",useWoundType:!0})}),e("td",{className:o,children:e(U,{entity:c,getCurrentCharacter:b,setEntity:l,property:"parryWithMali"})}),e("td",{className:o,children:e($,{entity:c,getCurrentCharacter:b,setEntity:l,property:"noParry",minValue:0})}),e("td",{className:o,children:e($,{entity:c,getCurrentCharacter:b,setEntity:l,property:"dizzy",minValue:0})}),e("td",{className:o,children:e(A,{entity:c,setEntity:l,property:"disarmed"})}),e("td",{className:o,children:e(A,{entity:c,setEntity:l,property:"onGround"})}),e("td",{className:o,children:e(A,{entity:c,setEntity:l,property:"consciousness"})}),e("td",{className:o,children:e(S,{entity:c,setEntity:l,property:"diesInRounds",minValue:0})}),e("td",{className:o,children:e(A,{entity:c,setEntity:l,property:"dead"})}),e("td",{className:o,children:e(oe,{entity:c,setEntity:l,property:"notes"})})]})}function ae({characters:o,setCharacters:t,currentId:n,setCurrentId:r,characterTable:s}){const a=(l,b)=>{t(x=>{const u=x.map(B.clone),M=u.findIndex(y=>y.id==b),w=u.findIndex(y=>y.id==l);return u[M]&&(u[M]=u[M].afterTurn(u)),u[w]=u[w].beforeTurn(u),r(l),u[w].canAct()||a(u[(w+1)%u.length].id,l),u}),s.current.querySelector('tr[data-character-id="'+l+'"]').scrollIntoView({behavior:"smooth",block:"center"})};function i(){return n==null&&o.length>0?new B("Niemand",0):o.find(l=>l.id==n)||new B("Niemand",0)}function h(){if(o.length==0)return;const b=(o.findIndex(x=>x.id==n)+1)%o.length;a(o[b].id,n)}const c=i();return p("div",{className:"container mx-auto",children:[p("span",{className:"text-2xl px-6",children:["An der Reihe: ",e("span",{className:"font-bold",children:c.name})]}),e("button",{type:"button",className:"inline-block px-7 py-3 bg-amber-600 text-white font-bold text-xl leading-snug uppercase rounded shadow-md hover:bg-amber-700 hover:shadow-lg focus:bg-amber-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-amber-800 active:shadow-lg transition duration-150 ease-in-out",onClick:h,children:"N\xE4chster!"})]})}function le({characters:o,setCharacters:t,currentId:n,setCurrentId:r}){const s="min-w-full divide-y divide-amber-200 table-fixed dark:divide-amber-700 w-full",a="bg-amber-100 dark:bg-amber-700 w-full z-10 sticky top-0 drop-shadow",i="py-3 text-xs font-medium tracking-wider text-left text-amber-700 uppercase dark:text-amber-400 sm:-rotate-90 xl:rotate-0 sm:px-1 xl:px-6",h="bg-white divide-y divide-amber-200 dark:bg-amber-800 dark:divide-amber-700",c="bottom-0 sticky bg-white/80",l=N.exports.useRef(null),b="py-1 text-sm font-medium text-amber-900 whitespace-nowrap dark:text-white sm:px-1 xl:px-6 align-middle text-center border-dotted border-x border-amber-600";return o.sort((x,u)=>u.ini-x.ini),p("table",{className:s,children:[e("thead",{className:a,children:p("tr",{children:[e("th",{scope:"col",className:i,children:"Chara"}),e("th",{scope:"col",className:i,children:"Ini"}),e("th",{scope:"col",className:i,children:"Treffer"}),e("th",{scope:"col",className:i,children:"Blutung / Runde"}),e("th",{scope:"col",className:i,children:"Boni/Mali"}),e("th",{scope:"col",className:i,children:"Muss mit ___ parieren"}),e("th",{scope:"col",className:i,children:"Runden Keine Parade"}),e("th",{scope:"col",className:i,children:"Runden Benommen"}),e("th",{scope:"col",className:i,children:"Entwaffnet"}),e("th",{scope:"col",className:i,children:"Am Boden"}),e("th",{scope:"col",className:i,children:"Bewusstlos"}),e("th",{scope:"col",className:i,children:"stirbt in __ Runden"}),e("th",{scope:"col",className:i,children:"tot"}),e("th",{scope:"col",className:i,children:"Notizen"})]})}),e("tbody",{className:h,ref:l,children:o.map((x,u)=>e(ie,{tdClass:b,isCurrent:n==x.id,currentId:n,isEven:u%2==0,characters:o,setCharacters:t,characterId:x.id},x.id))}),e("tfoot",{className:c,children:p("tr",{children:[e("td",{className:b,colSpan:7,children:e(ee,{setCharacters:t})}),e("td",{className:b,colSpan:7,children:e(ae,{characters:o,characterTable:l,setCharacters:t,currentId:n,setCurrentId:r})})]})})]})}function ce(){function o(){return JSON.parse(localStorage.getItem("characters")||"[]").map(h=>Object.assign(new B("",0),h))}function t(){return Number.parseInt(localStorage.getItem("currentId")||"")||null}function n(){localStorage.setItem("characters",JSON.stringify(a)),localStorage.setItem("currentId",JSON.stringify(r))}const[r,s]=N.exports.useState(t()),[a,i]=N.exports.useState(o());return N.exports.useEffect(n,[a]),e("div",{className:"App",children:e(le,{characters:a,setCharacters:i,currentId:r,setCurrentId:s})})}Y.render(e(Z.StrictMode,{children:e(ce,{})}),document.getElementById("root"));
