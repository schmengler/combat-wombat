var D=Object.defineProperty,G=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var T=(r,t,n)=>t in r?D(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n,z=(r,t)=>{for(var n in t||(t={}))H.call(t,n)&&T(r,n,t[n]);if(V)for(var n of V(t))_.call(t,n)&&T(r,n,t[n]);return r},P=(r,t)=>G(r,K(t));var m=(r,t,n)=>(T(r,typeof t!="symbol"?t+"":t,n),n);import{j as F,t as J,r as N,P as B,R as $,a as q}from"./vendor.f0d2a267.js";const U=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}};U();var E;(function(r){r.None="keine Wunde",r.Muscle="Muskel",r.Sinew="Sehne",r.Bones="Knochen",r.Organ="Organ"})(E||(E={}));class S{constructor(t){m(this,"characterId");m(this,"value",0);m(this,"rounds",0);m(this,"woundType",E.None);m(this,"inflictedByCharacterId",null);m(this,"fresh",!0);this.characterId=t}isEmpty(){return this.rounds==0}isInflictedBy(t){return t.id==this.inflictedByCharacterId}isInflictedByAny(t){const n=t.map(s=>s.id);return this.inflictedByCharacterId!==null&&n.includes(this.inflictedByCharacterId)}withRounds(t){return Object.assign(this,{rounds:this.rounds+t})}static clone(t){return Object.assign(new S(t.characterId),t)}withFresh(t){return Object.assign(this,{fresh:t})}isNotFresh(){return!this.fresh}}const j=class{constructor(t,n){m(this,"id");m(this,"name");m(this,"ini");m(this,"hits",0);m(this,"bleeding",0);m(this,"boniOrMali",[]);m(this,"parryWithMali",[]);m(this,"noParryRounds",0);m(this,"dizzyRounds",0);m(this,"diesInRounds",0);m(this,"onGround",!1);m(this,"disarmed",!1);m(this,"consciousness",!1);m(this,"dead",!1);m(this,"notes","");this.id=j.nextId++,this.name=t,this.ini=n}turnModifiers(t,n){return t.map(s=>S.clone(s)).map(s=>n(s)?s.withRounds(-1):s).map(s=>s.withFresh(!1)).filter(s=>s.rounds>0)}beforeTurn(t){const n=j.clone(this);return t.filter(s=>s.id!==n.id).forEach(s=>{s.boniOrMali=this.turnModifiers(s.boniOrMali,o=>o.isInflictedBy(n)),s.parryWithMali=this.turnModifiers(s.parryWithMali,o=>o.isInflictedBy(n))}),n.noParryRounds=Math.max(0,n.noParryRounds-1),n.dizzyRounds=Math.max(0,n.dizzyRounds-1),n.hits+=n.bleeding,n.diesInRounds=Math.max(0,n.diesInRounds-1),n.diesInRounds==0&&this.diesInRounds>0&&(n.dead=!0),n}afterTurn(t){const n=j.clone(this);return n.boniOrMali=this.turnModifiers(n.boniOrMali,s=>s.isInflictedBy(n)&&s.isNotFresh()||!s.isInflictedByAny(t)),n.parryWithMali=this.turnModifiers(n.parryWithMali,s=>s.isInflictedBy(n)&&s.isNotFresh()||!s.isInflictedByAny(t)),n}canAct(){return!this.dead&&!this.consciousness}static clone(t){return Object.assign(new j("",0),t)}};let C=j;m(C,"nextId",1);const e=F.exports.jsx,p=F.exports.jsxs;J.exports.Simulate.input;function Q({setCharacters:r}){return p("form",{onSubmit:n=>{n.preventDefault();const s=n.target.elements.namedItem("addText");if(s.value.trim()=="")return;const o=s.value.match(/^(?:(\d+) )?(.*?)(?: (\d+))?$/),a=Number.parseInt(o[1])||1,i=o[2],f=Number.parseInt(o[3])||0,d=Array.from({length:a},(l,b)=>new C(i+(a>1?" "+(b+1):""),f));r(l=>[...l,...d]),s.value=""},children:[e("svg",{className:"w-6 h-6 inline text-green-600",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e("path",{d:"M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"})}),e("input",{name:"addText",type:"text",className:"mx-2",placeholder:"[Anzahl] Name [Ini]"}),e("button",{type:"submit",className:"inline-block px-7 py-3 bg-amber-600 text-white font-bold text-xl leading-snug uppercase rounded shadow-md hover:bg-amber-700 hover:shadow-lg focus:bg-amber-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-amber-800 active:shadow-lg transition duration-150 ease-in-out",children:"Hinzuf\xFCgen"})]})}function X({setCharacters:r,characterId:t}){return e("button",{onClick:()=>{r(s=>{const o=s.findIndex(a=>a.id==t);return s.filter((a,i)=>i!=o)})},children:e("svg",{className:"w-6 h-6 inline text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7a4 4 0 11-8 0 4 4 0 018 0zM9 14a6 6 0 00-6 6v1h12v-1a6 6 0 00-6-6zM21 12h-6"})})})}function Y({entity:r,property:t,setEntity:n}){const s=N.exports.useRef(null),o=i=>{n(f=>Object.assign(Object.create(Object.getPrototypeOf(f)),P(z({},f),{[t]:i.target.elements[t].value}))),i.preventDefault()},a=()=>s.current.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}));return e("form",{onSubmit:o,ref:s,children:e("input",{type:"text",name:t,defaultValue:r[t],className:"w-12",onBlur:a})})}function R({entity:r,property:t,setEntity:n,minValue:s=Number.MIN_SAFE_INTEGER,invertColors:o=!1,useBigSteps:a=!1}){const i=N.exports.useRef(null),f=N.exports.useRef(null),d=N.exports.useRef(null),[l,b]=N.exports.useState(!1);function u(h){n(x=>{const O=Object.assign(Object.create(Object.getPrototypeOf(x)),x);return O[t]=h(O[t]),O})}const g=(h=1)=>()=>{u(x=>Math.max(s,x+h)),v()},y=(h=1)=>()=>{u(x=>Math.max(s,x-h)),v()},w=h=>{u(()=>Math.max(s,Number.parseInt(h.target.value)))},v=()=>b(!0),k=function(){setTimeout(()=>{document.activeElement?b(d.current==document.activeElement.parentElement||f.current==document.activeElement.parentElement):b(!1)},10)},M=h=>h.key=="Enter"&&h.target.blur(),I="inline-block m-1 rounded-full bg-red-600 text-white leading-normal uppercase shadow-md hover:bg-red-700 hover:shadow-lg focus:bg-red-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-red-800 active:shadow-lg transition duration-150 ease-in-out w-9 h-9",c="inline-block m-1 rounded-full bg-green-600 text-white leading-normal uppercase shadow-md hover:bg-green-700 hover:shadow-lg focus:bg-green-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-green-800 active:shadow-lg transition duration-150 ease-in-out w-9 h-9";return e("div",{className:"custom-number-input h-full w-full",children:p("div",{ref:d,className:"flex flex-col h-full w-full rounded-lg relative bg-transparent mt-1 items-center",children:[e("button",{className:"bg-amber-100 text-amber-600 hover:text-amber-700 hover:bg-amber-200 h-full w-10 rounded-r cursor-pointer",onClick:g(),onBlur:k,children:e("span",{className:"m-auto text-2xl font-thin",children:"+"})}),e("input",{type:"number",ref:i,className:"outline-none focus:outline-none text-center w-10 bg-amber-100 font-semibold text-md hover:text-black focus:text-black  md:text-basecursor-default flex items-center text-amber-700  outline-none border-0 focus:ring-0 px-0 text-sm",value:r[t],onClick:v,onChange:w,onKeyPress:M,onBlur:k}),e("button",{className:" bg-amber-100 text-amber-600 hover:text-amber-700 hover:bg-amber-200 h-full w-10 rounded-l cursor-pointer outline-none",onClick:y(),onBlur:k,children:e("span",{className:"m-auto text-2xl font-thin",children:"\u2212"})}),p("div",{ref:f,hidden:!l||!a,className:"absolute bg-amber-100 left-full p-2 z-10 drop-shadow",children:[e("button",{className:o?c:I,onClick:g(10),onBlur:k,children:"+10"}),e("button",{className:o?c:I,onClick:g(100),onBlur:k,children:"+100"}),e("br",{}),e("button",{className:o?I:c,onClick:y(10),onBlur:k,children:"-10"}),e("button",{className:o?I:c,onClick:y(100),onBlur:k,children:"-100"})]})]})})}R.propTypes={property:B.string,minValue:B.number,invertColors:B.bool,useBigSteps:B.bool};function L({entity:r,property:t,setEntity:n,characters:s,currentId:o,minValue:a=Number.MIN_SAFE_INTEGER,invertColors:i=!0,useWoundType:f=!1}){const d=r.id,[l,b]=N.exports.useState(!1),[u,g]=N.exports.useState(new S(d));function y(){return o==null&&s.length>0?r:s.find(c=>c.id==o)||r}const w=c=>{g(h=>{const x=Object.assign(new S(d),h);return x.woundType=E[c.target.value],x})},v=c=>{n(h=>{if(u.isEmpty())return h;const x=Object.assign(new C("",0),h),O=Object.assign(new S(d),u),W=y();return O.inflictedByCharacterId=W.id,g(new S(d)),x[t]=[...x[t],O],b(!1),x})},k=c=>()=>n(h=>{const x=Object.assign(new C("",0),h);return x[t]=x[t].filter(O=>O!==c),x}),M=N.exports.useRef(null),I=()=>{b(!1)};return N.exports.useEffect(()=>{const c=h=>{M.current&&!M.current.contains(h.target)&&I&&I()};return document.addEventListener("click",c,!0),()=>{document.removeEventListener("click",c,!0)}},[I]),p("div",{className:"h-full w-full relative cursor-help",children:[e("div",{className:"h-full w-full text-2xl",onClick:()=>b(c=>!c),children:r[t].reduce((c,h)=>c+h.value,0)}),p("div",{ref:M,hidden:!l,className:"absolute bg-amber-100 top-10 p-2 z-10 drop-shadow text-left",children:[e("ol",{children:r[t].map((c,h)=>p("li",{className:"text-xl",children:[e("button",{className:"inline-block text-orange-400",onClick:k(c),children:e("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),"\xA0",e("strong",{className:c.value>0?"text-green-600":"text-red-600",children:c.value}),"\xA0(",c.rounds,") \xA0",f&&e("strong",{children:c.woundType})]},h))}),e("button",{className:"block px-7 py-3 bg-amber-600 text-white font-bold text-xl leading-snug uppercase rounded shadow-md hover:bg-amber-700 hover:shadow-lg focus:bg-amber-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-amber-800 active:shadow-lg transition duration-150 ease-in-out",onClick:v,children:e("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),p("table",{children:[e("thead",{children:p("tr",{children:[e("th",{className:"font-bold text-center",children:"Runden"}),e("th",{className:"font-bold text-center",children:"Bonus/Malus"})]})}),p("tbody",{children:[p("tr",{children:[e("td",{children:e(R,{entity:u,setEntity:g,property:"rounds",minValue:0})}),e("td",{children:e(R,{entity:u,setEntity:g,property:"value",useBigSteps:!0,invertColors:i})})]}),f&&e("tr",{children:e("td",{colSpan:2,children:e("fieldset",{children:Object.entries(E).map(c=>p("label",{className:"block py-2 cursor-pointer",children:[e("input",{name:"woundType",value:c[0],type:"radio",onChange:w,className:"text-amber-600 focus:ring-amber-400"})," ",c[1]]},c[0]))})})})]})]})]})]})}L.propTypes={property:B.string,minValue:B.number,invertColors:B.bool,useWoundType:B.bool};function A({entity:r,setEntity:t,property:n}){const s=o=>{t(a=>{const i=Object.assign(Object.create(Object.getPrototypeOf(a)),a);return i[n]=o.target.checked,i})};return e("div",{className:"w-full relative",children:p("label",{className:"select-none container block relative cursor-pointer text-xl pl-8 left-1/2 -ml-4",children:[e("input",{className:"absolute opacity-0 left-0 top-0 cursor-pointer",type:"checkbox",checked:r[n],onChange:s}),e("span",{className:"h-6 w-6 checkmark absolute top-0 left-0 bg-amber-100"})]})})}function Z({entity:r,property:t,setEntity:n}){const s=N.exports.useRef(null),o=i=>{n(f=>Object.assign(Object.create(Object.getPrototypeOf(f)),P(z({},f),{[t]:i.target.elements[t].value}))),i.preventDefault()},a=()=>s.current.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}));return e("form",{onSubmit:o,ref:s,children:e("textarea",{name:t,defaultValue:r[t],className:"w-full",onBlur:a})})}function ee({tdClass:r,isEven:t,isCurrent:n,currentId:s,characters:o,setCharacters:a,characterId:i}){const f=o.findIndex(v=>v.id==i),d=o[f],l=v=>{a(k=>{const M=k.findIndex(c=>c.id==i),I=[...k];return I[M]=v(I[M]),I})},b="hover:bg-orange-50 dark:hover:bg-amber-700",u="bg-amber-50 hover:bg-orange-50 dark:hover:bg-amber-700",g=" bg-green-50",y=" bg-red-300 opacity-50",w=(t?u:b)+(n?g:"")+(d.canAct()?"":y);return p("tr",{className:w,"data-character-id":i,children:[p("td",{className:r+"overflow-hidden",children:[e(X,{setCharacters:a,characterId:i}),e("div",{className:"inline-block font-bold text-lg -rotate-90",children:d.name})]}),e("td",{className:r,children:e(Y,{entity:d,setEntity:l,property:"ini"})}),e("td",{className:r,children:e(R,{entity:d,setEntity:l,property:"hits",minValue:0,useBigSteps:!0})}),e("td",{className:r,children:e(R,{entity:d,setEntity:l,property:"bleeding",minValue:0})}),e("td",{className:r,children:e(L,{entity:d,characters:o,currentId:s,setEntity:l,property:"boniOrMali",useWoundType:!0})}),e("td",{className:r,children:e(L,{entity:d,characters:o,currentId:s,setEntity:l,property:"parryWithMali"})}),e("td",{className:r,children:e(R,{entity:d,setEntity:l,property:"noParryRounds",minValue:0})}),e("td",{className:r,children:e(R,{entity:d,setEntity:l,property:"dizzyRounds",minValue:0})}),e("td",{className:r,children:e(A,{entity:d,setEntity:l,property:"disarmed"})}),e("td",{className:r,children:e(A,{entity:d,setEntity:l,property:"onGround"})}),e("td",{className:r,children:e(A,{entity:d,setEntity:l,property:"consciousness"})}),e("td",{className:r,children:e(R,{entity:d,setEntity:l,property:"diesInRounds",minValue:0})}),e("td",{className:r,children:e(A,{entity:d,setEntity:l,property:"dead"})}),e("td",{className:r,children:e(Z,{entity:d,setEntity:l,property:"notes"})})]})}function te({characters:r,setCharacters:t,currentId:n,setCurrentId:s,characterTable:o}){const a=(l,b)=>{t(u=>{const g=u.findIndex(v=>v.id==b),y=u.findIndex(v=>v.id==l),w=[...u];return w[g]&&(w[g]=w[g].afterTurn(u)),w[y]=w[y].beforeTurn(u),s(l),w[y].canAct()||a(w[(y+1)%w.length].id,l),w}),o.current.querySelector('tr[data-character-id="'+l+'"]').scrollIntoView({behavior:"smooth",block:"center"})};function i(){return n==null&&r.length>0?new C("Niemand",0):r.find(l=>l.id==n)||new C("Niemand",0)}function f(){if(r.length==0)return;const b=(r.findIndex(u=>u.id==n)+1)%r.length;a(r[b].id,n)}const d=i();return p("div",{className:"container mx-auto",children:[p("span",{className:"text-2xl px-6",children:["An der Reihe: ",e("span",{className:"font-bold",children:d.name})]}),e("button",{type:"button",className:"inline-block px-7 py-3 bg-amber-600 text-white font-bold text-xl leading-snug uppercase rounded shadow-md hover:bg-amber-700 hover:shadow-lg focus:bg-amber-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-amber-800 active:shadow-lg transition duration-150 ease-in-out",onClick:f,children:"N\xE4chster!"})]})}function ne({characters:r,setCharacters:t,currentId:n,setCurrentId:s}){const o="min-w-full divide-y divide-amber-200 table-fixed dark:divide-amber-700 w-full",a="bg-amber-100 dark:bg-amber-700 w-full z-10 sticky top-0 drop-shadow",i="py-3 text-xs font-medium tracking-wider text-left text-amber-700 uppercase dark:text-amber-400 sm:-rotate-90 xl:rotate-0 sm:px-1 xl:px-6",f="bg-white divide-y divide-amber-200 dark:bg-amber-800 dark:divide-amber-700",d="bottom-0 sticky bg-white/80",l=N.exports.useRef(null),b="py-1 text-sm font-medium text-amber-900 whitespace-nowrap dark:text-white sm:px-1 xl:px-6 align-middle text-center border-dotted border-x border-amber-600";return r.sort((u,g)=>g.ini-u.ini),p("table",{className:o,children:[e("thead",{className:a,children:p("tr",{children:[e("th",{scope:"col",className:i,children:"Chara"}),e("th",{scope:"col",className:i,children:"Ini"}),e("th",{scope:"col",className:i,children:"Treffer"}),e("th",{scope:"col",className:i,children:"Blutung / Runde"}),e("th",{scope:"col",className:i,children:"Boni/Mali"}),e("th",{scope:"col",className:i,children:"Muss mit ___ parieren"}),e("th",{scope:"col",className:i,children:"Runden Keine Parade"}),e("th",{scope:"col",className:i,children:"Runden Benommen"}),e("th",{scope:"col",className:i,children:"Entwaffnet"}),e("th",{scope:"col",className:i,children:"Am Boden"}),e("th",{scope:"col",className:i,children:"Bewusstlos"}),e("th",{scope:"col",className:i,children:"stirbt in __ Runden"}),e("th",{scope:"col",className:i,children:"tot"}),e("th",{scope:"col",className:i,children:"Notizen"})]})}),e("tbody",{className:f,ref:l,children:r.map((u,g)=>e(ee,{tdClass:b,isCurrent:n==u.id,currentId:n,isEven:g%2==0,characters:r,setCharacters:t,characterId:u.id},u.id))}),e("tfoot",{className:d,children:p("tr",{children:[e("td",{className:b,colSpan:7,children:e(Q,{setCharacters:t})}),e("td",{className:b,colSpan:7,children:e(te,{characters:r,characterTable:l,setCharacters:t,currentId:n,setCurrentId:s})})]})})]})}function re(){function r(){return JSON.parse(localStorage.getItem("characters")||"[]").map(f=>Object.assign(new C("",0),f))}function t(){return Number.parseInt(localStorage.getItem("currentId")||"")||null}function n(){localStorage.setItem("characters",JSON.stringify(a)),localStorage.setItem("currentId",JSON.stringify(s))}const[s,o]=N.exports.useState(t()),[a,i]=N.exports.useState(r());return N.exports.useEffect(n,[a]),e("div",{className:"App",children:e(ne,{characters:a,setCharacters:i,currentId:s,setCurrentId:o})})}$.render(e(q.StrictMode,{children:e(re,{})}),document.getElementById("root"));
